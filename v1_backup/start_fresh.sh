#!/bin/bash

# Kill any existing processes
pkill -f streamlit
pkill -f python
sleep 2

# Clear all caches
find . -name "*.pyc" -delete
find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
rm -rf ~/.streamlit/

# Set environment variables
export OPENAI_API_KEY="sk-S_N3-OI2h814ONFCxnDw5w"
export ATLAN_API_TOKEN="eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJhUWEtTlRIRkkxU29BWHAtM1FDTzExcGhZY0w4dWNkeGVkMzBvN3ZuaHVnIn0.eyJleHAiOjE5MTY3MDQwOTQsImlhdCI6MTc1OTA0NDA5NCwianRpIjoiOGI0MWVhNmEtMjg1Ny00YjgyLWI1YTktNjVjMWU1YzdjZGQ4IiwiaXNzIjoiaHR0cHM6Ly9ob21lLmF0bGFuLmNvbS9hdXRoL3JlYWxtcy9kZWZhdWx0IiwiYXVkIjpbInJlYWxtLW1hbmFnZW1lbnQiLCJhY2NvdW50Il0sInN1YiI6IjIwMjQ1OGRmLTgwNGYtNGY4YS05MGQzLTYzZjk4YTFhYjg1NyIsInR5cCI6IkJlYXJlciIsImF6cCI6ImFwaWtleS0wZGJkMDdkNS05YjVlLTQ3ZGQtYTRjZC1hNDQ3OTJkZTA2ZDEiLCJyZXNvdXJjZV9hY2Nlc3MiOnsicmVhbG0tbWFuYWdlbWVudCI6eyJyb2xlcyI6WyJ2aWV3LXJlYWxtIiwidmlldy1pZGVudGl0eS1wcm92aWRlcnMiLCJtYW5hZ2UtaWRlbnRpdHktcHJvdmlkZXJzIiwiaW1wZXJzb25hdGlvbiIsInJlYWxtLWFkbWluIiwiY3JlYXRlLWNsaWVudCIsIm1hbmFnZS11c2VycyIsInF1ZXJ5LXJlYWxtcyIsInZpZXctYXV0aG9yaXphdGlvbiIsInF1ZXJ5LWNsaWVudHMiLCJxdWVyeS11c2VycyIsIm1hbmFnZS1ldmVudHMiLCJtYW5hZ2UtcmVhbG0iLCJ2aWV3LWV2ZW50cyIsInZpZXctdXNlcnMiLCJ2aWV3LWNsaWVudHMiLCJtYW5hZ2UtYXV0aG9yaXphdGlvbiIsIm1hbmFnZS1jbGllbnRzIiwicXVlcnktZ3JvdXBzIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6InByb2ZpbGUgb2ZmbGluZV9hY2Nlc3MgZW1haWwiLCJjcmVhdGVkQXQiOiIxNzU5MDQ0MDkyOTM3IiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRJZCI6ImFwaWtleS0wZGJkMDdkNS05YjVlLTQ3ZGQtYTRjZC1hNDQ3OTJkZTA2ZDEiLCJjbGllbnRIb3N0IjoiMTAuMTUzLjE5NC4xNzEiLCJncm91cHMiOltdLCJyZWFsbSI6ImRlZmF1bHQiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJzZXJ2aWNlLWFjY291bnQtYXBpa2V5LTBkYmQwN2Q1LTliNWUtNDdkZC1hNGNkLWE0NDc5MmRlMDZkMSIsInVzZXJJZCI6IjIwMjQ1OGRmLTgwNGYtNGY4YS05MGQzLTYzZjk4YTFhYjg1NyIsImNsaWVudEFkZHJlc3MiOiIxMC4xNTMuMTk0LjE3MSIsInVzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LWFwaWtleS0wZGJkMDdkNS05YjVlLTQ3ZGQtYTRjZC1hNDQ3OTJkZTA2ZDEifQ.TbymMn0vBBE9BNddbWj_w4tYsXE8k0dAc_i1wmHHvfiN_zOeDHi5HICsJwl4fGJv_R2HfDx87QYgjHCk9NEHDFmtm1m9EN2JK_n6KThjEORR-DOjB9Z_cmgRJ5en6ZQ7TXbzgLUaQNND1ogCTvrHYliok5SH1wXGmy5wzIsIRwsH_PhOSKZb0pt_ZIz90FLLZ2VXGU9wYBk5ehv-6iNHRcQdIjMDY4IMHOEVoA_5XD-Jm0om1mwWDOuTxmYHwuB0lQgNFpNU9-bUNKDMkoOitbS2KRgLCSFOnxy5bFE88EPo3xA60Pzf9lEL66rQi5cUVM3ECh2JXru6hYolQGlLkQ"

# Activate virtual environment and start app
source venv/bin/activate
streamlit run app.py --server.port 8530 --server.headless true 